\chapter{Rosenbrock Method}
\label{sec:ros}

Consider the autonomous \ac{IVP}
\begin{equation}
\left\{
\begin{aligned}
  \dot x &= f(x) \\
  x(t_0) &= x_0
\end{aligned}
\right.
\end{equation}
on an equidistant time discretization $t_{n+1} = t_n + \tau$ for $n\geq 0$ and some $\tau\in\R$.
Then, the $s$-stage Rosenbrock method~\Ros{$s$} reads
\begin{equation}
\label{eq:ros:def}
\left\{
\begin{aligned}
  x_{n+1} &:= x_n + \tau \sum_{j=1}^s b_j k_j
  \\
  k_i &:= f\left( x_n + \tau \sum_{j=1}^{i-1} \alpha_{ij} k_j \right) + \tau \Jac \sum_{j=1}^i \gamma_{ij} k_j
  \qquad
  \text{for } i = 1, \ldots, s
\end{aligned}
\right.
\end{equation}
where $\Jac := f'(x_n)$ denotes the Jacobian and $\alpha_{ij}, \gamma_{ij}, b_j$ are the determining coefficients.
We follow the common notation of neglecting a subscript $n$ for the stages $k_i=k_i(t_n)$.
In the remainder, we restrict the analysis to methods with $\gamma_{11} = \ldots = \gamma_{ss} =: \gamma$.
For certain choices of $\gamma$, such a method is of order $s$ or $s+1$ \cite{HairerWanner2}.

In this thesis we will focus on a first-order one-stage method as well as a second-order two-stage method.
The first method, \Ros{1}
\begin{equation}
\label{eq:ros:gen:ros1}
\left\{
\begin{aligned}
  x_{n+1} &= x_n + \tau k_1 \\
  (I - \tau \Jac) k_1 &= f(x_n)
\end{aligned}
\right.
\end{equation}
having $b_1=1$ and $\gamma=1$,
is often referred to as the \emph{(linearly) implicit Euler} scheme,
as it can be derived from the implicit Euler scheme
by a degree-1 Taylor approximation of $f(x_{n+1})$ around $f(x_n)$.
The second-order method, \Ros{2}
\begin{equation}
\label{eq:ros:gen:ros2}
\left\{
\begin{aligned}
  x_{n+1} &= x_n + \tfrac{3}{2} \tau k_1 + \tfrac{1}{2} \tau k_2 \\
  (I - \gamma\tau \Jac) k_1 &= f(x_n) \\
  (I - \gamma\tau \Jac) k_2 &= f(x_n + \tau k_1) - 2k_1
\end{aligned}
\right.
\end{equation}
having $\alpha_{21}=1$, $b_1=b_2=\frac{1}{2}$, and $\gamma_{21}=-2\gamma$,
was first described in \cite{Verwer1999}.\footnote{%
  The formulation \eqref{eq:ros:gen:ros2} as in \cite[Equation~(3.4)]{Verwer1999}
  is based on $k_1 := \hat k_1$ and $k_2 := \hat k_2 - 2 \hat k_1$,
  where $\hat k_1$ and $\hat k_2$ are the stages of the original form \eqref{eq:ros:def}.
  Hence, $b_1$ and $b_2$ do not coincide with the coefficients of the first equation of~\eqref{eq:ros:gen:ros2}.
}
This method is L-stable for $\gamma = 1 \pm \frac{\sqrt{2}}{2}$,
\cf~\cite[Table~6.4]{HairerWanner2},
of which we will use the larger option.

\section{Application to \act{DRE}s}

\todo{Maybe switch transposes: $AX$ and $XA^\HT$}
In the context of the autonomous \ac{DRE}
\begin{equation}
\label{eq:ros:DRE}
  \dot X = \Ricc(X) :=
  C^\T C + A^\T X + XA - X BB^\T X
\end{equation}
the Jacobian $\Jac := \Ricc'(X_n)$ is given by the \Frechet derivative.
Since $X$ is symmetric,
$\Jac$ is itself a \Lyapunov operator,
\begin{equation}
  \Ricc'(X_n) : U \mapsto (A - BB^\T X_n)^\T U + U (A - BB^\T X_n)
\end{equation}
\todo{Find Ref: all implicit methods lead to \ac{ALE}; DRE leads to ARE according to \cite{Dieci1992}}
which causes the stage equations~\eqref{eq:ros:def} to become \ac{ALE}.

Therefore, the implicit Euler scheme \Ros{1} reads
\begin{equation}
\label{eq:ros:DRE:ros1}
\left\{
\begin{aligned}
  X_{n+1} &= X_n + \tau K_1 \\
  \hat A_n^\T K_1 + K_1 \hat A_n &= -\Ricc(X_n)
\end{aligned}
\right.
\end{equation}
while \Ros{2} is given by
\begin{equation}
\label{eq:ros:DRE:ros2}
\left\{
\begin{aligned}
  X_{n+1} &= X_n + \tfrac{3}{2} \tau K_1 + \tfrac{1}{2} \tau K_2 \\
  \hat A_n^\T K_1 + K_1 \hat A_n &= -\Ricc(X_n) \\
  \hat A_n^\T K_2 + K_2 \hat A_n &= -\Ricc(X_n + \tau K_1) + 2K_1
\end{aligned}
\right.
\end{equation}
where $\hat A_n = \gamma\tau(A - BB^\T X_n) - \frac{1}{2} I$.
The following sections are devoted to efficient low-rank formulations of above right-hand sides.

\begin{remark}
  When formulating these methods for generalized \ac{DRE},
  \ie replacing
  \begin{align*}
    X &\gets E^\T X E, &
    A &\gets E^{-1} A, &
    B &\gets E^{-1} B
  \end{align*}
  and avoiding inversion of $E$,
  the stages are generalized \ac{ALE}
  with $E$ and $\hat A_n = \gamma\tau(A - BB^\T X_n E) - \frac{1}{2} E$
  having the same right-hand sides as above.
\end{remark}

\subsection{Low-Rank Formulation of the \Riccati Operator}

The following construction goes back to~\cite{Lang2015}.
Applying $\Ricc$ to a \ac{LRSIF} of rank $r\in\N$ reads
\begin{subequations}
\begin{align}
  \Ricc(LDL^\T)
  &= C^\T C + A^\T (LDL^\T) + (LDL^\T) A - (LDL^\T) BB^\T (LDL^\T) \\
  &= \begin{bmatrix}
    C^\T & A^\T L & L & L
  \end{bmatrix}
  \begin{bmatrix}
    I & . & . & . \\
    . & . & D & . \\
    . & D & . & . \\
    . & . & . & - DL^\T BB^\T LD
  \end{bmatrix}
  \begin{bmatrix}
    C \\
    L^\T A \\
    L^\T \\
    L^\T
  \end{bmatrix} \\
  &= \begin{bmatrix}
    C^\T & A^\T L & L
  \end{bmatrix}
  \begin{bmatrix}
    I & . & . \\
    . & . & D \\
    . & D & - DL^\T BB^\T LD
  \end{bmatrix}
  \begin{bmatrix}
    C \\
    L^\T A \\
    L^\T
  \end{bmatrix} \\
  &=: GSG^\T
\end{align}
\end{subequations}
which is itself a \ac{LRSIF} of rank $n_C + 2r$.

\begin{remark}
  For generalized \ac{DRE} it is $G = \begin{bmatrix}
    C^\T & A^\T L & E^\T L
  \end{bmatrix}$.
\end{remark}

\subsection{\Riccati Operator of a Shifted Argument}

The following construction goes back to \cite{Mena2007}.\footnote{%
  The original contains many small mistakes,
  which have hopefully all been eliminated in this thesis.
}
Evaluating the \Riccati operator is rather expensive.
In the context of \Ros{2}~\eqref{eq:ros:DRE:ros2},
we therefore aim to reuse the evaluation of $\Ricc$ necessary to compute the first stage $K_1$
for the computation of $K_2$.
First, expand the \Riccati operator of a shifted argument
\begin{subequations}
\begin{align}
  \Ricc(X_n + \tau K_1)
  &= \begin{multlined}[t]
    \Ricc(X_n) + \tau A^\T K_1 + \tau K_1 A \\
    - \tau K_1 BB^\T X_n - \tau X_n BB^\T K_1 - \tau^2 K_1 BB^\T K_1
  \end{multlined} \\
  &= \begin{multlined}[t]
    \Ricc(X_n) - \tau^2 K_1 BB^\T K_1 \\
    + \tau(A - BB^\T X_n)^\T K_1 + \tau K_1 (A - BB^\T X_n)
  \end{multlined}
\end{align}
\end{subequations}
and use that to rewrite the right-hand side of the second stage
\begin{subequations}
\begin{align}
  \MoveEqLeft
  -\Ricc(X_n + \tau K_1) + 2K_1
  \nonumber \\
  &= \begin{multlined}[t]
    -\Ricc(X_n) + \tau^2 K_1 BB^\T K_1 + 2K_1 \\
    - \tau(A - BB^\T X_n)^\T K_1 - \tau K_1 (A - BB^\T X_n)
  \end{multlined} \\
  &= \begin{multlined}[t]
    -\Ricc(X_n) + \tau^2 K_1 BB^\T K_1 \\
    - \underbrace{
      \big(\tau(A - BB^\T X_n) - I\big)
    }_{\frac{1}{\gamma} \hat{A}_n - \big( 1-\frac{1}{2\gamma} \big) I}
    \!{\vphantom{\big(}}^\T
    K_1
    - K_1
    \underbrace{
      \big(\tau(A - BB^\T X_n) - I\big)
    }_{\text{dito}}
  \end{multlined} \\
  &=
  -\Ricc(X_n) + \tau^2 K_1 BB^\T K_1
  -\tfrac{1}{\gamma}
  \underbrace{
    (\hat{A}_n^\T K_1 + K_1 \hat{A}_n)
  }_{-\Ricc(X_n)}
  + \big( 2-\tfrac{1}{\gamma} \big) K_1 \\
  &= -\big(1-\tfrac{1}{\gamma}\big) \Ricc(X_n)
  + \tau^2 K_1 BB^\T K_1
  + \big( 2-\tfrac{1}{\gamma} \big) K_1
\end{align}
\end{subequations}
using the first stage equation.
In summary:
\begin{equation}
\left\{
\begin{aligned}
  X_{n+1} &= X_n + \tfrac{3}{2} \tau K_1 + \tfrac{1}{2} \tau K_2 \\
  \hat A_n^\T K_1 + K_1 \hat A_n &= -\Ricc(X_n) \\
  \hat A_n^\T K_2 + K_2 \hat A_n &=
  -\big(1-\tfrac{1}{\gamma}\big) \Ricc(X_n)
  + \tau^2 K_1 BB^\T K_1
  + \big( 2-\tfrac{1}{\gamma} \big) K_1
\end{aligned}
\right.
\end{equation}

\todo{Check $()$ versus $\big(\big)$.}
For arbitrary $\gamma$, this allows a decomposition of $K_2$ according to:
\begin{equation}
\left\{
\begin{aligned}
  X_{n+1} &= X_n + \tfrac{3}{2} \tau K_1 + \tfrac{1}{2} \tau K_2 \\
  \hat A_n^\T K_1 + K_1 \hat A_n &= -\Ricc(X_n) \\
  \hat A_n^\T K_{21} + K_{21} \hat A_n &= \tau^2 K_1 BB^\T K_1 + \big( 2-\tfrac{1}{\gamma} \big) K_1 \\
  K_2 &= \big( 1-\tfrac{1}{\gamma} \big) K_1 + K_{21}
\end{aligned}
\right.
\end{equation}
Then substituting $K_2$ into the update equation yields:
\begin{equation}
\left\{
\begin{aligned}
  X_{n+1} &= X_n + \big( 2 - \tfrac{1}{2\gamma} \big) \tau K_1 + \tfrac{1}{2} \tau K_{21} \\
  \hat A_n^\T K_1 + K_1 \hat A_n &= -\Ricc(X_n) \\
  \hat A_n^\T K_{21} + K_{21} \hat A_n &= \tau^2 K_1 BB^\T K_1 + \big( 2-\tfrac{1}{\gamma} \big) K_1
\end{aligned}
\right.
\end{equation}

\todo[inline]{low-rank formulation of RHS of $K_{21}$}

\section{Alternative One-Step Methods}
